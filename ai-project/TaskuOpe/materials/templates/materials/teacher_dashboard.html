{% extends 'partials/base.html' %}

{% block title %}Opettajan kojelauta{% endblock %}

{% block content %}



  <!-- ====================================================== -->
  <!-- SECTION 1: YOUR MATERIALS (This is the part you provided) -->
  <!-- ====================================================== -->
  <section class="materials">
    <h2>Omat materiaalisi</h2>

    <!-- AI NAPPI -->
    {% if user.is_authenticated and user.role == 'TEACHER' %}
  <div style="margin-bottom:1rem;">
    <a class="btn primary" href="{% url 'create_material' %}">Luo uusi materiaali</a>
  </div>
  {% endif %} 

    {% for m in materials %}
      <article class="card">
        <h3>{{ m.title }} (v{{ m.version }})</h3>

        <!-- Displaying new, relevant fields from your updated database model -->
        <p class="muted">Tila: {{ m.get_status_display }} | Aihe: {{ m.subject|default:'Ei määritelty' }}</p>
        
        <!-- These are the buttons for the next steps in the teacher's workflow -->
        <div style="margin-top: 10px; display: flex; gap: 0.5rem;">
            <a class="btn" href="{% url 'material_detail' material_id=m.id %}">Tarkastele</a>
            <a class="btn primary" href="{% url 'assign_material' material_id=m.id %}">Anna tehtäväksi</a>
              <form method="post" action="{% url 'delete_material' material_id=m.id %}" style="display:inline;">
          {% csrf_token %}
          <button class="btn" style="border-color:#c82333; color:#c82333;"
            onclick="return confirm('Poistetaanko materiaali: {{ m.title }}? Tämä poistaa myös siihen liittyvät tehtävänannot.')">
      Poista
    </button>
        </div>
      </article>
    {% empty %}
      <p class="muted">Et ole vielä luonut materiaaleja.</p>
    {% endfor %}
  </section>

  <hr style="margin: 2rem 0; border: none; border-top: 1px solid #ddd;">

  <!-- ====================================================== -->
  <!-- SECTION 2: ASSIGNMENTS (This is the new part) -->
  <!-- ====================================================== -->
  <section class="assignments">
    <h2>Tekemäsi tehtävänannot</h2>

    {% for assignment in assignments %}
      <article class="card">
        <h3>{{ assignment.material.title }}</h3>
        <p class="muted">Annettu oppilaalle: {{ assignment.student.get_full_name|default:assignment.student.username }}</p>
        <p class="muted">Tila: {{ assignment.get_status_display }}</p>
        {% if assignment.due_at %}
            <p class="muted">Määräaika: {{ assignment.due_at|date:"d.m.Y H:i" }}</p>
        {% endif %}
        
        <!-- This link will be used in a future step for grading submissions -->
        <div style="margin-top: 10px;">
            <a class="btn" href="#">Tarkastele palautusta</a>
              <form method="post" action="{% url 'delete_assignment' assignment_id=assignment.id %}" style="display:inline;">
    {% csrf_token %}
    <button class="btn" style="border-color:#c82333; color:#c82333;"
            onclick="return confirm('Poistetaanko tämä tehtävänanto oppilaalta {{ assignment.student.get_full_name|default:assignment.student.username }}?')">
      Poista
    </button>
  </form>
        </div>
      </article>
    {% empty %}
      <p class="muted">Et ole vielä antanut yhtään tehtävää.</p>
    {% endfor %}
  </section>

{% endblock %}