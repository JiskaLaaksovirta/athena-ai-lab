{% extends 'partials/base.html' %}
{% block title %}Luo uusi materiaali{% endblock %}

{% block content %}
<h1>Luo uusi materiaali</h1>

{% if messages %}
  <ul class="messages">
    {% for message in messages %}
      <li class="{{ message.tags }}">{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}

<form method="post">
  {% csrf_token %}

  <!-- AI-paneeli -->
  <fieldset style="margin-bottom:1rem;">
    <legend>AI-testi (täyttää Content-kentän, ei tallenna)</legend>
    <label for="id_ai_prompt">Aihe/ohje AI:lle</label>
    <textarea id="id_ai_prompt" name="ai_prompt" rows="4"
      placeholder="Esim. 'Johdanto prosenttilaskentaan 7.-luokalle, 45 min, 3 harjoitusta.'">{{ ai_prompt }}</textarea>
    <p>
      <!-- Estä HTML5-validointi AI-painikkeella -->
      <button type="submit" name="action" value="ai" class="btn" formnovalidate>Kysy AI:lta</button>
    </p>
  </fieldset>

  {% if ai_reply %}
    <details open class="mb-4" style="margin-bottom:1rem;">
      <summary>AI:n raakavastaus</summary>
      <pre id="ai_reply_box" class="p-3 border rounded bg-light" style="white-space:pre-wrap">{{ ai_reply }}</pre>
      <!-- Valinnainen apu: kopioi vastaus Content-kenttään -->
      <button type="button" class="btn" onclick="
        const t=document.getElementById('ai_reply_box').innerText;
        const field=document.getElementById('id_content');
        if(field){ field.value = (field.value ? field.value + '\n\n' : '') + t; }
      ">Kopioi sisällöksi</button>
    </details>
  {% endif %}

  <hr>

  <!-- Materiaalin varsinainen lomake -->
  {{ form.as_p }}

  <br>
  <!-- Tallennuksessa validointi kuuluu toimia normaalisti -->
  <button type="submit" name="action" value="save" class="btn primary">Tallenna materiaali</button>
</form>
{% endblock %}
