<div class="card shadow-sm mb-3 h-100">
  <div class="card-body d-flex flex-column">
    <div class="d-flex justify-content-between align-items-start">
      <h6 class="mb-1">{{ a.material.title }}</h6>
      <span class="badge text-bg-secondary">{{ badge }}</span>
    </div>

    <small class="text-muted mb-2">
      Opettaja: {{ a.assigned_by.get_full_name|default:a.assigned_by.username }} ·
      Määräaika: {{ a.due_at|date:"d.m.Y H:i"|default:"—" }}
      {% if a.due_at and a.due_at < now and a.status != 'SUBMITTED' and a.status != 'GRADED' %}
        <span class="badge bg-danger ms-1">Myöhässä</span>
      {% endif %}
    </small>

    <p class="mb-3 text-truncate-3">{{ a.material.content|truncatechars:160 }}</p>

    <div class="mt-auto d-flex gap-2">
      <a class="btn btn-sm btn-primary" href="{% url 'assignment_detail' assignment_id=a.id %}">Avaa</a>

      {% if a.status == 'ASSIGNED' or a.status == 'IN_PROGRESS' %}
        <form method="post" action="{% url 'assignment_detail' assignment_id=a.id %}">
          {% csrf_token %}
          <input type="hidden" name="save_draft" value="1">
          <input type="hidden" name="response" value="">
          <button class="btn btn-sm btn-outline-secondary" type="submit">
            {% if a.status == 'ASSIGNED' %}Aloita{% else %}Jatka{% endif %}
          </button>
        </form>
      {% endif %}
    </div>
  </div>
</div>
