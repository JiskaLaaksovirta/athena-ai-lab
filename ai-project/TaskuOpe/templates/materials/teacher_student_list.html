{% extends 'partials/base.html' %}
{% block title %}Oppilaiden hallinta{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
    <h1 class="h2 mb-0">Oppilaiden hallinta</h1>
    <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left me-1"></i> Takaisin etusivulle
    </a>
  </div>

<!-- Suodatin -->
<form method="get" class="filter-panel p-3 p-md-4 rounded-3 mb-4">
  <div class="row g-3 align-items-end">
    <div class="col-md-5">
      <label for="student-query" class="form-label fw-semibold mb-1">Suodata oppilaan nimellä</label>
      <input type="text"
             id="student-query"
             name="q"
             value="{{ q|default_if_none:'' }}"
             class="form-control"
             placeholder="Nimi tai nimimerkki">
    </div>

    <div class="col-md-4">
      <label for="grade-filter" class="form-label fw-semibold mb-1">Suodata luokan mukaan</label>
      <select id="grade-filter" name="grade" class="form-select">
        <option value="">Kaikki luokat</option>
        {% for value,label in grade_choices %}
          <option value="{{ value }}" {% if value == selected_grade %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-3 d-flex gap-2 justify-content-md-end">
      <button type="submit" class="btn btn-primary">
        <i class="bi bi-funnel me-1"></i> Suodata
      </button>
      <a href="{% url 'teacher_student_list' %}" class="btn btn-outline-secondary">Tyhjennä</a>
    </div>
  </div>
</form>

  <div class="card shadow-sm">
    <div class="card-body">
      <form method="post">
        {% csrf_token %}
        <input type="hidden" name="action" value="update_grades">

        <!-- MUUTOS 1: Poistettu .table-responsive ja lisätty .tasks-luokka tableen -->
        <table class="table table-hover align-middle tasks">
          <thead class="table-light">
            <tr>
              <th>Oppilas</th>
              <th>Nykyinen luokka</th>
              <th>Vaihda luokkaa</th>
            </tr>
          </thead>
          <tbody>
            {% for student in students %}
              <tr>
                <!-- MUUTOS 2: Lisätty data-labelit jokaiseen soluun Näyttää nimen, jos ei oo näytetään nimimerkki-->
                <td data-label="Oppilas">{{ student.get_full_name|default:student.username }}</td>
                <td data-label="Nykyinen luokka">{{ student.get_grade_class_display|default:"Ei asetettu" }}</td>
                <td data-label="Vaihda luokkaa">
                  <select name="student-{{ student.id }}" class="form-select form-select-sm" style="max-width: 200px;">
                    <option value="">— Poista luokalta —</option>
                    {% for grade, display in grade_choices %}
                      <option value="{{ grade }}" {% if student.grade_class == grade %}selected{% endif %}>
                        {{ display }}
                      </option>
                    {% endfor %}
                  </select>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="3" class="text-center text-muted py-4">Järjestelmässä ei ole oppilaita.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>

        <div class="mt-3 text-end">
          <button type="submit" class="btn btn-primary">Tallenna muutokset</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}